// open-next.config.ts
// ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Next.jsã®ãƒ“ãƒ«ãƒ‰çµæœã‚’Cloudflare Workerså½¢å¼ã«å¤‰æ›ã™ã‚‹ãŸã‚ã®è¨­å®šã§ã™ã€‚
// OpenNext CLIã®å³æ ¼ãªè¦ä»¶ã‚’æº€ãŸã™ãŸã‚ã€overrideãƒ–ãƒ­ãƒƒã‚¯ã‚’æ˜ç¤ºã—ã¾ã™ã€‚

// eslint-disable-next-line import/no-anonymous-default-export
export default {
  // ----------------------------------------------------
  // 1. Next.jsã®ãƒšãƒ¼ã‚¸/APIãƒ«ãƒ¼ãƒˆã«é–¢ã™ã‚‹ãƒ¡ã‚¤ãƒ³è¨­å®š
  // ----------------------------------------------------
  default: {
    // å¤‰æ›ã•ã‚ŒãŸ Worker ã®å‡ºåŠ›å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    out: ".worker-next",
    
    // ğŸ’¡ å¿…é ˆ: CLIã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€šéã•ã›ã‚‹ãŸã‚ã«ç©ºã®overrideã‚’è¿½åŠ 
    override: {}, 
  },

  // ----------------------------------------------------
  // 2. Cloudflare Edgeç’°å¢ƒã§Node.jsãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã©ã†æ‰±ã†ã‹
  // ----------------------------------------------------
  // Next.jsã®App Routerã¯ã€ä¸€éƒ¨ã®Node.jsã®å†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
  // ã“ã‚Œã‚‰ã‚’Cloudflareã®äº’æ›ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å‡¦ç†ã™ã‚‹ã‚ˆã†æŒ‡å®šã—ã¾ã™ã€‚
  edgeExternals: ["node:crypto", "node:async_hooks"],


  // ----------------------------------------------------
  // 3. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ (src/middleware.ts) ã«é–¢ã™ã‚‹è¨­å®š
  // ----------------------------------------------------
  // middlewareã‚’Workersã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã«å¿…é ˆã®è¨­å®šã§ã™ã€‚
  middleware: {
    // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦Workerã«å«ã‚ã‚‹ã“ã¨ã‚’æŒ‡å®š
    external: true, 
  },
};